<div *ngIf="loading">Caricamento...</div>

<div *ngIf="cocktail" class="cocktail-detail-container">
  <div class="top-section">
    <!-- Immagine -->
    <div class="cocktail-image">
      <img [src]="cocktail.strDrinkThumb" alt="{{ cocktail.strDrink }}" />
    </div>

    <!-- Info principali -->
    <div class="cocktail-info">
      <h2>{{ cocktail.strDrink }}</h2>
      <p><strong>Categoria:</strong> {{ cocktail.strCategory }}</p>
      <p><strong>Alcolico:</strong> {{ cocktail.strAlcoholic }}</p>
    </div>
  </div>

  <!-- Sezione inferiore: istruzioni e ingredienti -->
  <div class="bottom-section">
    <div class="cocktail-instructions">
      <h3>Istruzioni</h3>
      <p>{{ cocktail.strInstructions }}</p>
    </div>

    <div class="cocktail-ingredients">
      <h3>Ingredienti</h3>
      <ul class="ingredient-list">
        <!-- Genera i dots in base al numero di ingredienti -->
        <li *ngFor="let i of getIngredientDots()">
          <ng-container *ngIf="cocktail['strIngredient' + i]">
            <div class="ingredient">
              <span class="dot"></span> 
              {{ cocktail['strIngredient' + i] }} - {{ cocktail['strMeasure' + i] || '' }}
            </div>
          </ng-container>
        </li>
      </ul>      
    </div>
  </div>
  
  <!-- Places Reviews Section -->
  <div class="places-section mt-5">
    <h3 class="text-center mb-4">Where to find this cocktail near you</h3>
    
    <!-- Location error message -->
    <div *ngIf="locationError" class="alert alert-warning my-3">
      {{ locationError }}
    </div>
    
    <!-- Loading indicator for reviews -->
    <div *ngIf="reviewsLoading" class="text-center py-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading nearby places...</span>
      </div>
    </div>
    
    <!-- No reviews message -->
    <div *ngIf="!reviewsLoading && placeReviews.length === 0" class="text-center py-3">
      <p class="text-muted">No places serving this cocktail found near your location.</p>
    </div>
    
    <!-- Reviews grid -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div *ngFor="let place of placeReviews" class="col">
        <div class="card h-100 place-card" (click)="navigateToPlace(place.googlePlaceId)">
          <!-- Loading state -->
          <div *ngIf="place.loading" class="card-img-top place-image-placeholder d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          
          <!-- Error state -->
          <div *ngIf="!place.loading && place.error" class="card-img-top place-image-placeholder d-flex align-items-center justify-content-center">
            <div class="text-muted">Place details not available</div>
          </div>
          
          <!-- Image -->
          <img *ngIf="!place.loading && !place.error && place.photoUrl" 
               [src]="place.photoUrl" 
               class="card-img-top place-image" 
               alt="{{ place.name || 'Place' }}">
          
          <!-- No image placeholder -->
          <div *ngIf="!place.loading && !place.error && !place.photoUrl" class="card-img-top place-image-placeholder d-flex align-items-center justify-content-center">
            <div class="text-muted">No image available</div>
          </div>
          
          <div class="card-body">
            <h5 class="card-title">{{ place.name || 'Unknown Place' }}</h5>
            <p class="card-text text-muted small mb-2">{{ place.address || 'No address available' }}</p>
            <div class="d-flex justify-content-between align-items-center mt-2">
              <div class="rating">
                <span class="stars">{{ getStarRating(place.averageScore) }}</span>
                <span class="average">{{ place.averageScore.toFixed(1) }}</span>
              </div>
              <span class="review-count">{{ place.reviewCount }} {{ place.reviewCount === 1 ? 'review' : 'reviews' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>