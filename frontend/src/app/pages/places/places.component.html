<div class="container mt-4">
  <h2 class="mb-4 text-center">Places</h2>

  <div class="search-container position-relative mb-4">
    <div class="input-group">
      <input
        type="text"
        class="form-control"
        placeholder="Search for places..."
        [(ngModel)]="searchTerm"
        (input)="search(searchTerm)"
        aria-label="Search"
      />
      <button 
        *ngIf="searchTerm" 
        class="btn btn-outline-secondary" 
        type="button"
        (click)="clearSearch()">
        Clear
      </button>
    </div>

    <div *ngIf="hasError" class="alert alert-danger mt-2">
      {{ errorMessage }}
    </div>
  </div>

  <h5 *ngIf="searchTerm" class="text-muted text-center mb-3">Results</h5>

  <div *ngIf="isLoading" class="text-center p-2">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- GRID DEI RISULTATI DELLA SEARCH -->
  <div *ngIf="searchTerm && searchResults.length > 0 && !isLoading"
       class="search-places-section mt-5">

    <div class="place-grid"
         infiniteScroll
         [infiniteScrollDistance]="scrollDistance"
         [infiniteScrollThrottle]="150"
         (scrolled)="displayNextSearchPlaces()">

      <div *ngFor="let place of displayedSearchPlaces" class="text-center">

        <div class="place-card position-relative mx-auto">
          <a class="image-link d-block position-relative"
             (click)="goToPlaceDetails(place)">
            <img class="place-image" [src]="place.photoUrl"
                 alt="Place photo" />
          </a>
        </div>

        <!-- INFO SOTTO LA CARD -->
        <div class="place-info text-center">
          <div class="fw-bold">{{ place.name }}</div>
          <div class="text-muted small">{{ getFormattedAddress(place) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Nearby Places -->
  <div *ngIf="!searchTerm" class="nearby-places-section mt-5">
    <div class="text-center mb-3">
      <h5 class="text-muted mb-2">Nearby Places</h5>
<!--       <button class="btn btn-outline-primary uniform-button" (click)="searchNearbyPlaces()" [disabled]="isLoadingNearby">
        <i class="bi bi-arrow-repeat me-1"></i> Refresh
      </button> -->
    </div>
    

    <div *ngIf="isLoadingNearby" class="text-center py-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading nearby places...</span>
      </div>
    </div>

    <div *ngIf="nearbyError" class="alert alert-danger">
      <p>Error finding nearby places. Please allow location access and try again.</p>
    </div>

    <div *ngIf="!isLoadingNearby && !nearbyError && displayedNearbyPlaces.length === 0" class="text-center py-3">
      <p class="text-muted">No places found nearby. Try searching for a specific place.</p>
    </div>

    <div 
      class="place-grid"
      *ngIf="!isLoadingNearby && displayedNearbyPlaces.length > 0"
      infiniteScroll
      [infiniteScrollDistance]="scrollDistance"
      [infiniteScrollThrottle]="150"
      (scrolled)="displayNextNearbyPlaces()"
    >
  
        <div *ngFor="let place of displayedNearbyPlaces" class="text-center">
  
        <div class="place-card position-relative mx-auto">
          <a (click)="goToPlaceDetails(place)" class="image-link d-block position-relative">
            <img class="place-image" [src]="place.photoUrl" alt="Place photo" />
          </a>
        </div>
      
        <!-- INFO SOTTO LA CARD -->
        <div class="place-info text-center">
          <div class="fw-bold">{{ place.name }}</div>
          <div class="text-muted small">{{ getFormattedAddress(place) }}</div>
        </div>
      </div>
    </div>
      
  
    </div>
  </div>
